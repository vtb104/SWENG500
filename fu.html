<!DOCTYPE html> 
<html> 
<head> 
  <title>Field Unit</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.min.css">
  <style>
    #map_canvas{
	position: absolute;
	left: 0px;
	bottom: 0px;
	height: 100%;
	width: 100%;
	z-index: 10;
}
  </style>
  <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
  <script src="https://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.min.js"></script>
  <script src="https://maps.googleapis.com/maps/api/js?sensor=true"></script>
<script>
navigator.geolocation.getCurrentPosition (function (pos)
{
  var lat = pos.coords.latitude;
  var lng = pos.coords.longitude;
  $("#lat").val (lat);
  $("#lng").val (lng);
});

//Runs on load
var initialize = function(){
    var timer = setInterval(function(){sendPosition()}, 5000);
}

var sendPosition = function(){
    if ( navigator.geolocation ) 
    {
	var sendMsg = new Object();
	sendMsg.user = "2";
	sendMsg.lat = $("#lat").val();
	sendMsg.lng = $("#lng").val();
	
	var formattedMsg = JSON.stringify(sendMsg);
	
	$("#info").html("Sending location...");
	$.ajax({
		type: "POST",
		url: "messageReceive.php",
		data: {dataMsg:formattedMsg},
		success: function(msg){
			if(msg){
				$("#info").html(msg);
			}else{
				$("#info").html(msg);
			}
		}
	});
        return true;
    }
    else
    {
        $("#info").html("Geo Location not possible");
        return false;
    }
}

$( document ).on( "pageinit", "#geoMap", function() {
    var defaultLatLng = new google.maps.LatLng(34.0983425, -118.3267434);  // Default to Hollywood, CA when no geolocation support

    if ( navigator.geolocation ) 
    {
	function success(pos)
        {
            // Location found, show map with these coordinates
            drawMap(new google.maps.LatLng(pos.coords.latitude, pos.coords.longitude));
	}

	function fail(error) 
        {
            drawMap(defaultLatLng);  // Failed to find location, show default map
	}

	// Find the users current position.  Cache the location for 5 minutes, timeout after 6 seconds
	navigator.geolocation.getCurrentPosition(success, fail, {maximumAge: 500000, enableHighAccuracy:true, timeout: 6000});
    } 
    else 
    {
	drawMap(defaultLatLng);  // No geolocation support, show default map
    }

    function drawMap(latlng) 
    {
	var myOptions = {
	zoom: 15,
	center: latlng,
	mapTypeId: google.maps.MapTypeId.ROADMAP
	};

	var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);

	// Add an overlay to the map of current lat/lng
	var marker = new google.maps.Marker({
	position: latlng,
	map: map,
	title: "SAR Map"
	});
    }
});
/*
$( document ).on( "pageinit", "#geoMap", function() {
    var lat = $("#lat").val ();
    var lng = $("#lng").val ();
    var latlng = new google.maps.LatLng (lat, lng);
    
    //Sets options for the map with vars above
    var myOptions = {
        zoom: 15, 
        center: latlng,
        mapTypeControl: true,
	mapTypeId : google.maps.MapTypeId.TERRAIN
    };
	
    //Creates the map
    map = new google.maps.Map(document.getElementById('map_canvas'), myOptions);

    var markerOptions = {
        map: null,  
        position: latlng
    };
    var positionMarker = new google.maps.Marker(markerOptions);
    positionMarker.setMap(map);
});
*/
</script>
  
</head> 
<body onLoad="initialize()"> 

<div data-role="page" id="initFU">
        <div data-role="header">
            <a href="#mapHelp" class="ui-btn ui-btn-inline ui-corner-all ui-shadow">Help</a>
            <h1>Map</h1>
        </div>

        <div data-role="panel" id="initFUHelp"> 
            <h2>Field Unit Help</h2>
            <p>You can close the help panel by clicking outside the panel, pressing the Esc key or by swiping.</p>
            <p>insert help text here</p>
        </div>
		
        <div data-role="content">
            <h3>Display Google Map based on GPS location 03</h3>
            <span> Latitude : </span> <input type=text id=lat />
            <span> Longitude : </span> <input type=text id=lng />
        </div>
    
	<div data-role="content">
            <div id="info" style="color: red">Info Here</div>
        </div>
    
        <div data-role="footer" data-position="fixed">
            <div data-role="navbar">
                <ul>
                    <li><a href="#initFU">Init</a></li>
                    <li><a href="#geoMap">Map</a></li>
                    <li><a href="#message">Messages</a></li>
                    <li><a href="#configure">Configure</a></li>
                </ul>
            </div>
        </div>
</div> 

<div data-role=page id=geoMap>
        <div data-role=header>
            <a href="#geoMapHelp" class="ui-btn ui-btn-inline ui-corner-all ui-shadow">Help</a>
            <h1>Geo Location Map</h1>
        </div>
    
        <div data-role="panel" id="geoMapHelp"> 
                <h2>Geo Map Help</h2>
                <p>You can close the help panel by clicking outside the panel, pressing the Esc key or by swiping.</p>
                <p>insert help text here</p>
        </div>

        <div role="main" class="ui-content" id="map_canvas">
		<!-- map loads here... -->
	</div>
    
        <div data-role="footer" data-position="fixed">
            <div data-role="navbar">
                <ul>
                    <li><a href="#initFU">Init</a></li>
                    <li><a href="#geoMap">Map</a></li>
                    <li><a href="#message">Messages</a></li>
                    <li><a href="#configure">Configure</a></li>
                </ul>
            </div>
        </div>
</div>
    
<div data-role="page" id="message">
        <div data-role="header">
            <a href="#msgHelp" class="ui-btn ui-btn-inline ui-corner-all ui-shadow">Help</a>
            <h1>Messages</h1>
        </div>

        <div data-role="panel" id="msgHelp"> 
            <h2>Message Help</h2>
            <p>You can close the help panel by clicking outside the panel, pressing the Esc key or by swiping.</p>
            <p>insert help text here</p>
        </div> 

        <div data-role="content">
            <h3>Send and Get Messages</h3>
        </div>

        <div data-role="footer" data-position="fixed">
            <div data-role="navbar">
                <ul>
                    <li><a href="#initFU">Init</a></li>
                    <li><a href="#geoMap">Map</a></li>
                    <li><a href="#message">Messages</a></li>
                    <li><a href="#configure">Configure</a></li>
                </ul>
            </div>
        </div>
</div> 

<div data-role="page" id="configure">
        <div data-role="header">
            <a href="#confHelp" class="ui-btn ui-btn-inline ui-corner-all ui-shadow">Help</a>
            <h1>Configure</h1>
        </div>

        <div data-role="panel" id="confHelp"> 
            <h2>Configuration Help</h2>
            <p>You can close the help panel by clicking outside the panel, pressing the Esc key or by swiping.</p>
            <p>insert help text here</p>
        </div> 

        <div data-role="content">
            <h3>Configure the SAR Mobile App</h3>
        </div>

        <div data-role="footer" data-position="fixed">
            <div data-role="navbar">
                <ul>
                    <li><a href="#initFU">Init</a></li>
                    <li><a href="#geoMap">Map</a></li>
                    <li><a href="#message">Messages</a></li>
                    <li><a href="#configure">Configure</a></li>
                </ul>
            </div>
        </div>
</div> 

</body>
</html>
